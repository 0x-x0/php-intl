language: php

php:
  - 5.6

# environment variable
env:
 - FOO=bar

build:
 cache: true
 cache_dir_list:
    -  /root/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/

 ci:
    - php -v
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - cat $HOME/.phpenv/versions/$(phpenv version-name)/etc/php.ini
    # Debug before
    - find $HOME/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/
    - find $HOME/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/ -name intl.so | wc -l
    - echo "extension=intl.so" >> $HOME/.phpenv/versions/$(phpenv version-name)/etc/php.ini;
    - >
      if [ $(find $HOME/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/ -name intl.so | wc -l) -eq 0 ]; then
        # Install PHP "intl" extension for \Collator class usage
        pickle install --ansi intl
        echo "extension=intl.so" >> $HOME/.phpenv/versions/$(phpenv version-name)/etc/php.ini;
      fi;
    # Debug after
    - find $HOME/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/
    - find $HOME/.phpenv/versions/$(phpenv version-name)/lib/php/extensions/ -name intl.so | wc -l
    - cat $HOME/.phpenv/versions/$(phpenv version-name)/etc/php.ini
    - phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage test.php
